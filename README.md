# 123云盘下载与管理工具

## 简介

该脚本提供命令行方式操作 123 云盘：浏览、批量下载、批量上传、获取直链、创建/删除目录等，并支持 Tab 自动补全与多编号/范围表达式。

## 新增特性概述
- 数字编号 + 范围表达式批量下载：`download 1 3-5 8,10-12` 或空格分隔多个表达式。
- 批量上传：`upload file1.txt image*.jpg a/b/c.zip` （支持通配符，自动跳过目录）。
- Tab 补全：命令、下载编号、上传路径。输入命令首字母后按 Tab 自动补全；`download` 后按 Tab 显示文件编号；`upload` 后本地路径补全（目录带 `/` 结尾）。
- 多线程下载：默认并发 3，可在代码中修改 `self.max_workers`。
- 进度显示：实时百分比与下载速度。

## 环境准备
1. 安装 Python 3.x。
2. 安装依赖：
```bash 
pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple --no-cache-dir requests
```

## 启动
```bash
python web.py
```
首次运行若无配置文件会提示输入账号密码，完成后写入 `123pan.txt`。

## 交互命令
| 命令 | 用法示例 | 说明 |
|------|----------|------|
| ls | `ls` | 列出当前目录文件与文件夹（文件黄色，目录紫色）。 |
| <编号> | `3` | 若是目录编号进入目录；若是文件编号显示文件大小并可选择下载。 |
| download | `download 1 3-5 10` | 批量下载：支持单个编号与区间（区间写法 `a-b`）。可多个表达式。 |
| link | `link 4` | 获取第 4 个条目的直链。 |
| delete | `delete 2` | 删除第 2 项。 |
| cd | `cd 5` / `cd ..` / `cd /` | 进入目录编号 / 返回上级 / 回到根目录。 |
| mkdir | `mkdir newFolder` | 创建当前目录下的新目录。重复不创建。 |
| upload | `upload a.txt img*.png` | 上传一个或多个文件（支持通配符）。若仅输入 `upload` 会交互式输入路径。 |
| re | `re` | 刷新当前目录。 |
| log | `log` | 重新登录（刷新 token）。 |
| reload | `reload` | 重新读取 `123pan.txt`。 |
| help | `help` | 显示帮助。 |
| exit | `exit` | 退出程序。 |

## 下载表达式说明
- 单个编号：`download 5`
- 多个编号：`download 1 2 9`
- 区间：`download 3-7`
- 混合：`download 1 3-5 9 12-14`
- 逗号分隔亦可：`download 1,3-5,9` （内部会统一剖析）
- 自动去重与越界跳过：`download 1 1 999`（会提示跳过越界）

## 批量上传说明
- 支持多个参数：`upload a.txt b.txt`
- 支持通配符：`upload *.zip data/*.csv`
- 路径中目录会被跳过（仅当前实现不传文件夹）。

## Tab 补全
- 命令补全：输入前缀按 Tab。
- download 下的编号补全：输入 `download ` 然后连续 Tab 轮询编号。
- upload 路径补全：输入部分文件名或目录前缀按 Tab 展开，目录结尾追加 `/` 方便继续深入。

## 常见问题
1. 登录失败 code=1：检查账号密码是否正确；必要时删除 `123pan.txt` 重新运行。  
2. 下载出现覆盖提示：脚本检测到同名文件，输入选择即可。  
3. 速度为 0 或很慢：可能为网络或官方限速，稍候再试。  
4. 如何修改并发数：编辑 `web.py` 中 `self.max_workers`。  

## 后续计划
- 路径模式操作与远程 Tab 补全（目录/文件名）
- 目录递归下载与打包压缩
- 上传支持文件夹递归
- 分享命令改为批量表达式

## 免责声明
仅供学习与研究使用，请勿用于商业或违规用途。风险自负。
